{% extends 'index.html' %}
{% load static %}
{% load humanize %}

{% block css %}
<link href="{% static 'assets/css/product_v2.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}

<section class="product-v2-page">
  <div class="container">

    <!-- HEADER -->
    <div class="product-v2-header">
      <h3>
        Tìm thấy <strong>{{ total_products }}</strong>
        {% if company_name %}
          sản phẩm từ <strong>{{ company_name }}</strong>
        {% endif %}
      </h3>
    </div>

    <div class="product-v2-layout">

      <!-- ================= PRODUCT GRID ================= -->
      <div class="product-v2-list">

        <div class="product-v2-grid">
          {% for product in product_names %}
          <div class="product-v2-card">

            <a href="{% url 'product_detail' product.slug %}" class="product-v2-image">
              <img src="{{ product.product_image.url }}" alt="">
              <span class="product-v2-badge">
                {{ product.discount_percentage }}% OFF
              </span>
            </a>

            <div class="product-v2-info">
              <h4 class="product-v2-name">
                <a href="{% url 'product_detail' product.slug %}">
                  {{ product.product_name }}
                </a>
              </h4>

              <p class="product-v2-desc">
                {{ product.product_description }}
              </p>

              <div class="product-v2-price">
                <span class="price-new">
                  {{ product.discounted_price|intcomma }} đ
                </span>
                <span class="price-old">
                  {{ product.orignal_price|intcomma }} đ
                </span>
              </div>
            </div>

          </div>
          {% endfor %}
        </div>

        <!-- PAGINATION -->
        <div class="product-v2-pagination">
          <ul>
            {% if product_names.has_previous %}
              <li><a href="?page={{ product_names.previous_page_number }}">‹</a></li>
            {% endif %}

            {% for i in product_names.paginator.page_range %}
              <li class="{% if product_names.number == i %}active{% endif %}">
                <a href="?page={{ i }}">{{ i }}</a>
              </li>
            {% endfor %}

            {% if product_names.has_next %}
              <li><a href="?page={{ product_names.next_page_number }}">›</a></li>
            {% endif %}
          </ul>
        </div>

      </div>

      <!-- ================= SIDEBAR ================= -->
      <aside class="product-v2-sidebar">

        <h4>Bộ lọc sản phẩm</h4>

        <form action="{% url 'product' %}" method="post">
          {% csrf_token %}
          <input type="hidden" name="company_name" value="{{ company_name }}">

          {% if messages %}
          <div class="alert alert-warning">
            {% for message in messages %}
              {{ message }}
            {% endfor %}
          </div>
          {% endif %}

          <div class="form-group">
            <label>Tên sản phẩm</label>
            <input type="text" name="search" placeholder="Nhập tên sản phẩm">
          </div>

          <div class="form-group">
            <label>Khoảng giá</label>
            <div class="price-range">
              <input type="number" name="price_from" placeholder="Từ">
              <span>-</span>
              <input type="number" name="price_to" placeholder="Đến">
            </div>
          </div>

          <button type="submit" class="btn-filter">
            <i class="fa fa-search"></i> Lọc ngay
          </button>
        </form>

        {% if show_top_companies %}
        <h4 class="m-t-20">Thương hiệu nổi bật</h4>
        <ul class="brand-list">
          {% for company, count in company_counts.items %}
          <li>
            <a href="{% url 'product_by_company' company_name=company %}">
              {{ company }} <span>({{ count }})</span>
            </a>
          </li>
          {% endfor %}
        </ul>
        {% endif %}

      </aside>

    </div>
  </div>
</section>

{% endblock %}
